<!-- src/views/admin/orders.ejs -->
<div class="container-admin-orders">
  <div class="title-admin-orders">
    <h1>Quản lý đơn hàng</h1>
  </div>

  <div class="table-responsive">
    <table class="table table-striped table-hover">
      <thead class="table-dark">
        <tr>
          <th>Mã đơn</th>
          <th>Khách hàng</th>
          <th class="text-end">Tổng tiền</th>
          <th>Trạng thái</th>
          <th>Hành động</th>
        </tr>
      </thead>

      <tbody>
        <% if (orders.length === 0) { %>
          <tr>
            <td colspan="5" class="text-center py-4">Chưa có đơn hàng nào</td>
          </tr>
        <% } else { %>
          <% orders.forEach(order => { %>
            <tr data-order-id="<%= order._id %>">
              <td class="fw-bold">#<%= order._id.toString().slice(-8) %></td>

              <td>
                <%= order.shipping.firstName %> <%= order.shipping.lastName %>
                <div>
                  <small class="text-muted"><%= order.contactEmail %></small>
                </div>
              </td>

              <td class="text-end fw-bold">
                <%= order.total.toLocaleString('vi-VN') %> ₫
              </td>

              <td>
                <span class="badge status-badge <%= order.status %>" id="status-<%= order._id %>">
                  <%= {
                    pending: "Chờ xác nhận",
                    processing: "Đang xử lý",
                    shipped: "Đã giao vận chuyển",
                    delivered: "Đã giao hàng",
                    cancelled: "Đã hủy",
                    paid: "Đã thanh toán"
                    payment_pending: "Chờ thanh toán"
                  }[order.status] || order.status %>
                </span>
              </td>

              <td>
                <form class="status-form d-inline" data-order-id="<%= order._id %>">
                  <select class="form-select form-select-sm d-inline-block w-auto status-select" name="status" required>
                    <option value="pending" <%= order.status === 'pending' ? 'selected' : '' %>>Chờ xác nhận</option>
                    <option value="processing" <%= order.status === 'processing' ? 'selected' : '' %>>Đang xử lý</option>
                    <option value="shipped" <%= order.status === 'shipped' ? 'selected' : '' %>>Đã giao vận chuyển</option>
                    <option value="delivered" <%= order.status === 'delivered' ? 'selected' : '' %>>Đã giao hàng</option>
                    <option value="paid" <%= order.status === 'paid' ? 'selected' : '' %>>Đã thanh toán</option>
                    <option value="pending_payment" <%= order.status === 'pending_payment' ? 'selected' : '' %>>Chờ thanh toán</option>
                    <option value="cancelled" <%= order.status === 'cancelled' ? 'selected' : '' %>>Đã hủy</option>
                  </select>

                  <button type="submit" class="btn btn-primary">Cập nhật</button>
                </form>
              </td>
            </tr>
          <% }) %>
        <% } %>
      </tbody>
    </table>
  </div>

  <button class="back-button btn btn-secondary" onclick="window.location.href='/admin'">
    Back to Admin Dashboard
  </button>
</div>

<style>
  .status-badge {
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 600;
    display: inline-block;
  }

  .pending {
    background: #fff3cd;
    color: #856404;
  }

  .processing {
    background: #d1ecf1;
    color: #0c5460;
  }

  .shipped {
    background: #d4edda;
    color: #155724;
  }

  .delivered {
    background: #c3e6cb;
    color: #155724;
  }

  .cancelled {
    background: #f8d7da;
    color: #721c24;
  }

  .paid {
    background: #d1ecf1;
    color: #0c5460;
  }

.pending_payment {
  background: #e96e10;
  color: #ffffff;
}

  .table-hover tr:hover {
    background-color: #f8f9fa;
  }
</style>
