<div class="container-detail">
  <div class="detail-header">
    <a href="/admin/orders" class="btn-back">← Quay lại danh sách</a>
    <div class="order-meta">
      <h1>Đơn hàng #<%= order._id.toString().slice(-6).toUpperCase() %></h1>
      <span class="badge status-badge <%= order.status %>"> <%= order.status.toUpperCase() %> </span>
    </div>
  </div>

  <div class="detail-grid">
    <div class="info-card">
      <h3>Thông tin khách hàng</h3>
      <div class="info-row">
        <strong>Họ tên:</strong>
        <span><%= order.shipping.firstName %> <%= order.shipping.lastName %></span>
      </div>
      <div class="info-row">
        <strong>Email:</strong>
        <span><%= order.contactEmail || order.user.email %></span>
      </div>
      <div class="info-row">
        <strong>SĐT:</strong>
        <span><%= order.shipping.phone %></span>
      </div>

      <hr />

      <h3>Địa chỉ giao hàng</h3>
      <p class="address-text"><%= order.shipping.address %>, <%= order.shipping.city %></p>

      <div class="info-row">
        <strong>Phương thức thanh toán:</strong>
        <span><%= order.paymentMethod || 'COD' %></span>
      </div>
    </div>

    <div class="items-card">
      <h3>Danh sách sản phẩm</h3>
      <table class="table-items">
        <thead>
          <tr>
            <th>Sản phẩm</th>
            <th class="text-center">SL</th>
            <th class="text-end">Đơn giá</th>
            <th class="text-end">Thành tiền</th>
          </tr>
        </thead>
        <tbody>
          <% order.items.forEach(item => { %>
          <tr>
            <td>
              <div class="item-info">
                <% if(item.product) { %>
                <img src="<%= item.product.imageUrl || '/images/default.png' %>" alt="" width="50" />
                <div>
                  <p class="item-name"><%= item.product.title %></p>
                  <small class="text-muted">ID: <%= item.product._id %></small>
                </div>
                <% } else { %>
                <span class="text-danger">Sản phẩm này đã bị xóa</span>
                <% } %>
              </div>
            </td>
            <td class="text-center">x<%= item.quantity %></td>
            <td class="text-end"><%= item.price.toLocaleString() %> ₫</td>
            <td class="text-end fw-bold"><%= (item.price * item.quantity).toLocaleString() %> ₫</td>
          </tr>
          <% }) %>
        </tbody>
        <tfoot>
          <tr>
            <td colspan="3" class="text-end">Tạm tính:</td>
            <td class="text-end"><%= (order.total).toLocaleString() %> ₫</td>
          </tr>
          <tr>
            <td colspan="3" class="text-end"><strong>Tổng cộng:</strong></td>
            <td class="text-end total-price"><%= order.total.toLocaleString() %> ₫</td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>
</div>
